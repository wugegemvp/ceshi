
<!DOCTYPE html>
<html lang="zh">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1e40af">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Debt and Spending Tracker - ä¸ªäººè´¢åŠ¡è¿½è¸ªå™¨</title>
    <!-- å¼•å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, query, onSnapshot, addDoc, updateDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // å¼ºåˆ¶å¼€å¯Debugæ—¥å¿—
        setLogLevel('Debug');

        // ----------------------------------------------------
        // å…¨å±€å˜é‡å’Œåˆå§‹åŒ–
        // ----------------------------------------------------
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'debt-tracker-app';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;
        let currentUserId = null;
        let isAuthReady = false;
        let isFriendMode = false; // NEW: Track if using the shared passcode

        // ç§˜å¯†é€šè¡Œç  (å·²ä»ä»£ç ä¸­ç§»é™¤å…·ä½“æ•°å­—ï¼Œä»¥ä¿éšœéšç§)
        // å®é™…çš„é€šè¡Œç åªæœ‰æ‚¨å’Œæœ‹å‹çŸ¥é“ï¼Œç°åœ¨ä½¿ç”¨å ä½ç¬¦
        const FRIEND_PASSCODES = ['666666', '888888']; // ä»ç„¶ä½¿ç”¨åŸæœ‰çš„å ä½ç è¿›è¡Œæ¯”è¾ƒ

        // UI å…ƒç´ 
        const appContainer = document.getElementById('app-container');
        const loginContainer = document.getElementById('login-container');
        const passcodeInput = document.getElementById('passcode-input');
        const loginBtn = document.getElementById('login-btn');
        const googleLoginBtn = document.getElementById('google-login-btn');
        const loginError = document.getElementById('login-error');
        const debtsList = document.getElementById('debts-list');
        const expensesList = document.getElementById('expenses-list');
        const addDebtForm = document.getElementById('add-debt-form');
        const addExpenseForm = document.getElementById('add-expense-form');
        const userIdDisplay = document.getElementById('user-id-display');
        const signOutBtn = document.getElementById('sign-out-btn');
        const provider = new GoogleAuthProvider();

        // ----------------------------------------------------
        // è®¤è¯å’Œåˆå§‹åŒ–å‡½æ•°
        // ----------------------------------------------------
        async function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // å°è¯•ç”¨ custom token ç™»å½•
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    // Sign in anonymously if no custom token provided
                    await signInAnonymously(auth);
                }
                
                // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–ï¼Œå¹¶æ›´æ–°UIå’Œæ•°æ®
                onAuthStateChanged(auth, (user) => {
                    isAuthReady = true;
                    if (user) {
                        currentUserId = user.uid;
                        // Only update display if not in friend mode
                        if (!isFriendMode) {
                            userIdDisplay.textContent = currentUserId;
                        }
                        console.log("Auth state changed. User ID:", currentUserId);
                    } else {
                        currentUserId = null;
                        console.log("User signed out.");
                    }
                    
                    // If user signs out from Firebase, reset friend mode flag
                    if (!user) {
                        isFriendMode = false;
                        userIdDisplay.textContent = "æœªç™»å½•";
                    }

                    // åªæœ‰åœ¨è®¤è¯çŠ¶æ€æ›´æ–°åæ‰å†³å®šæ˜¾ç¤ºå“ªä¸ªé¡µé¢
                    // å¦‚æœæ˜¯ Google/Firebase ç™»å½•æˆåŠŸ (user is truthy) æˆ–è€…å·²ç»é€šè¿‡é€šè¡Œç è¿›å…¥æœ‹å‹æ¨¡å¼ï¼Œåˆ™æ˜¾ç¤º App
                    if (user || isFriendMode) {
                        showApp();
                    } else {
                        // å¦‚æœæ˜¯åŒ¿å/åˆå§‹ç™»å½•ï¼Œå…ˆæ˜¾ç¤ºç™»å½•é¡µé¢
                        showLogin();
                    }
                });

            } catch (error) {
                console.error("Firebase åˆå§‹åŒ–æˆ–è®¤è¯å¤±è´¥:", error);
                // å³ä½¿åˆå§‹åŒ–å¤±è´¥ï¼Œä¹Ÿè¦æ˜¾ç¤ºç™»å½•ç•Œé¢
                showLogin(); 
            }
        }

        // ----------------------------------------------------
        // UI é€»è¾‘
        // ----------------------------------------------------

        function showLogin() {
            appContainer.classList.add('hidden');
            loginContainer.classList.remove('hidden');
            // æ¸…ç©ºåˆ—è¡¨ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²
            debtsList.innerHTML = '';
            expensesList.innerHTML = '';
            loginError.classList.add('hidden'); // Hide any previous error
        }

        function showApp() {
            loginContainer.classList.add('hidden');
            appContainer.classList.remove('hidden');
            // Update display based on mode
            if (isFriendMode) {
                userIdDisplay.textContent = 'å…±äº«-æœ‹å‹é€šè¡Œç ';
            } else if (currentUserId) {
                userIdDisplay.textContent = currentUserId;
            }
            // ç¡®ä¿åªåœ¨æ˜¾ç¤ºAppæ—¶è®¾ç½®ç›‘å¬å™¨
            setupListeners();
            loginError.classList.add('hidden'); // Hide any login error once app is shown
        }
        
        // æœ‹å‹é€šè¡Œç ç™»å½•
        loginBtn.addEventListener('click', () => {
            const enteredCode = passcodeInput.value.trim();
            
            if (FRIEND_PASSCODES.includes(enteredCode)) {
                loginError.classList.add('hidden');
                
                // FIX: Set friend mode flag and a dummy ID for public path resolution
                isFriendMode = true;
                currentUserId = 'friend_group_shared'; // Dummy ID for path logic
                
                showApp();
            } else {
                loginError.textContent = 'é€šè¡Œç é”™è¯¯ï¼Œè¯·ä½¿ç”¨ç§˜å¯†é€šè¡Œç ã€‚';
                loginError.classList.remove('hidden');
            }
        });
        
        // æ‚¨çš„ Google è´¦å·ç™»å½•
        googleLoginBtn.addEventListener('click', async () => {
             try {
                // Ensure friend mode is disabled if switching to Google Auth
                isFriendMode = false;
                const result = await signInWithPopup(auth, provider);
                // ç™»å½•æˆåŠŸå onAuthStateChanged ä¼šè‡ªåŠ¨å¤„ç† showApp()
                console.log("Google ç™»å½•æˆåŠŸ", result.user);
            } catch (error) {
                console.error("Google ç™»å½•å¤±è´¥:", error);
                loginError.textContent = 'Google ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚';
                loginError.classList.remove('hidden');
            }
        });
        
        // é€€å‡ºç™»å½•
        signOutBtn.addEventListener('click', async () => {
            // Reset flags and sign out from Firebase Auth
            isFriendMode = false;
            await signOut(auth);
            // é€€å‡ºå onAuthStateChanged ä¼šè‡ªåŠ¨è°ƒç”¨ showLogin()
        });


        // ----------------------------------------------------
        // Firestore æ•°æ®æ“ä½œå’Œç›‘å¬
        // ----------------------------------------------------

        // è·å–ç”¨æˆ·æ•°æ®è·¯å¾„ (ç§æœ‰æ•°æ®æˆ–å…¬å…±æ•°æ®)
        function getUserCollectionRef(collectionName) {
            if (!db) {
                console.error("Database is not ready.");
                return null;
            }
            
            let path;
            if (isFriendMode) {
                // Passcode mode -> Public/Shared Data
                // Path: /artifacts/{appId}/public/data/{collectionName}
                path = `artifacts/${appId}/public/data/${collectionName}`;
            } else if (currentUserId) {
                // Google/Authenticated mode -> Private Data
                // Path: /artifacts/{appId}/users/{currentUserId}/{collectionName}
                path = `artifacts/${appId}/users/${currentUserId}/${collectionName}`;
            } else {
                console.error("User ID is not ready and not in Friend Mode.");
                return null;
            }
            
            return collection(db, path);
        }

        // æ¸²æŸ“å€ºåŠ¡åˆ—è¡¨ (ä¸å˜)
        function renderDebts(debts) {
            debtsList.innerHTML = '';
            let totalDebt = 0;
            if (debts.length === 0) {
                debtsList.innerHTML = `<li class="text-center py-4 text-gray-500">æš‚æ— æ¬ æ¬¾è®°å½•ã€‚</li>`;
                return;
            }
            
            debts.forEach(debt => {
                const item = document.createElement('li');
                item.className = 'flex justify-between items-center p-3 border-b border-red-100 last:border-b-0 hover:bg-red-50 rounded-lg';
                item.innerHTML = `
                    <div>
                        <p class="font-bold text-lg text-red-700">Â¥${debt.amount.toFixed(2)}</p>
                        <p class="text-sm text-gray-600">å¯¹è±¡: ${debt.person}</p>
                        <p class="text-xs text-gray-400">å¤‡æ³¨: ${debt.note || 'æ— '}</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button data-id="${debt.id}" data-amount="${debt.amount}" data-type="debt-pay" class="pay-btn px-3 py-1 bg-green-500 text-white text-xs font-medium rounded-full hover:bg-green-600 transition">å·²è¿˜æ¸…</button>
                        <button data-id="${debt.id}" data-type="debt-delete" class="delete-btn text-red-400 hover:text-red-700 text-lg">&times;</button>
                    </div>
                `;
                debtsList.appendChild(item);
                totalDebt += debt.amount;
            });
            document.getElementById('total-debt-display').textContent = totalDebt.toFixed(2);
        }
        
        // æ¸²æŸ“å¼€æ”¯åˆ—è¡¨ (ä¸å˜)
        function renderExpenses(expenses) {
            expensesList.innerHTML = '';
            let totalExpense = 0;
            if (expenses.length === 0) {
                expensesList.innerHTML = `<li class="text-center py-4 text-gray-500">æš‚æ— å¼€æ”¯è®°å½•ã€‚</li>`;
                return;
            }
            
            expenses.forEach(expense => {
                const item = document.createElement('li');
                item.className = 'flex justify-between items-center p-3 border-b border-indigo-100 last:border-b-0 hover:bg-indigo-50 rounded-lg';
                item.innerHTML = `
                    <div>
                        <p class="font-bold text-lg text-indigo-700">Â¥${expense.amount.toFixed(2)}</p>
                        <p class="text-sm text-gray-600">ç±»åˆ«: ${expense.category}</p>
                        <p class="text-xs text-gray-400">å¤‡æ³¨: ${expense.note || 'æ— '}</p>
                    </div>
                    <button data-id="${expense.id}" data-type="expense-delete" class="delete-btn text-red-400 hover:text-red-700 text-lg">&times;</button>
                `;
                expensesList.appendChild(item);
                totalExpense += expense.amount;
            });
            document.getElementById('total-expense-display').textContent = totalExpense.toFixed(2);
        }

        // æ·»åŠ å€ºåŠ¡
        addDebtForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const amount = parseFloat(document.getElementById('debt-amount').value);
            const person = document.getElementById('debt-person').value.trim();
            const note = document.getElementById('debt-note').value.trim();

            if (isNaN(amount) || amount <= 0 || !person) {
                // Display error message to user
                loginError.textContent = "è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢å’Œæ¬ æ¬¾å¯¹è±¡åç§°ï¼ˆå¦‚ï¼š100 å’Œ æœ‹å‹Aï¼‰ã€‚";
                loginError.classList.remove('hidden');
                console.error("è¯·ç¡®ä¿é‡‘é¢æœ‰æ•ˆä¸”æ¬ æ¬¾å¯¹è±¡éç©ºã€‚");
                return; 
            } else {
                loginError.classList.add('hidden');
            }
            
            // FIX: ç¡®ä¿è®¤è¯å°±ç»ªï¼Œå¹¶ä¸”æœ‰å¯ç”¨çš„ç”¨æˆ·èº«ä»½
            if (!isAuthReady || (!currentUserId && !isFriendMode)) {
                loginError.textContent = "èº«ä»½éªŒè¯æœªå®Œæˆï¼Œè¯·ç¨å€™å†è¯•æˆ–é‡æ–°ç™»å½•ã€‚";
                loginError.classList.remove('hidden');
                console.error("èº«ä»½éªŒè¯æœªå°±ç»ªæˆ–ç”¨æˆ·IDç¼ºå¤±ã€‚");
                return;
            }

            const collectionRef = getUserCollectionRef('debts');
            if (!collectionRef) return;

            try {
                await addDoc(collectionRef, {
                    amount: amount,
                    person: person,
                    note: note,
                    createdAt: serverTimestamp()
                });
                addDebtForm.reset();
            } catch (error) {
                // Display error message to user
                loginError.textContent = "è®°å½•æ¬ æ¬¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–æƒé™ã€‚";
                loginError.classList.remove('hidden');
                console.error("æ·»åŠ å€ºåŠ¡è®°å½•å¤±è´¥:", error);
            }
        });

        // æ·»åŠ å¼€æ”¯
        addExpenseForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const amount = parseFloat(document.getElementById('expense-amount').value);
            const category = document.getElementById('expense-category').value;
            const note = document.getElementById('expense-note').value.trim();

            if (isNaN(amount) || amount <= 0) {
                // Display error message to user
                loginError.textContent = "è¯·è¾“å…¥æœ‰æ•ˆçš„å¼€æ”¯é‡‘é¢ã€‚";
                loginError.classList.remove('hidden');
                console.error("è¯·ç¡®ä¿é‡‘é¢æœ‰æ•ˆã€‚");
                return; 
            } else {
                loginError.classList.add('hidden');
            }

            // FIX: ç¡®ä¿è®¤è¯å°±ç»ªï¼Œå¹¶ä¸”æœ‰å¯ç”¨çš„ç”¨æˆ·èº«ä»½
            if (!isAuthReady || (!currentUserId && !isFriendMode)) {
                loginError.textContent = "èº«ä»½éªŒè¯æœªå®Œæˆï¼Œè¯·ç¨å€™å†è¯•æˆ–é‡æ–°ç™»å½•ã€‚";
                loginError.classList.remove('hidden');
                console.error("èº«ä»½éªŒè¯æœªå°±ç»ªæˆ–ç”¨æˆ·IDç¼ºå¤±ã€‚");
                return;
            }

            const collectionRef = getUserCollectionRef('expenses');
            if (!collectionRef) return;

            try {
                await addDoc(collectionRef, {
                    amount: amount,
                    category: category,
                    note: note,
                    createdAt: serverTimestamp()
                });
                addExpenseForm.reset();
            } catch (error) {
                // Display error message to user
                loginError.textContent = "è®°å½•å¼€æ”¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–æƒé™ã€‚";
                loginError.classList.remove('hidden');
                console.error("æ·»åŠ å¼€æ”¯è®°å½•å¤±è´¥:", error);
            }
        });

        // åˆ é™¤è®°å½•
        document.addEventListener('click', async (e) => {
            const target = e.target;
            const recordId = target.dataset.id;
            const recordType = target.dataset.type;
            
            if (!currentUserId && !isFriendMode) return; // ç¡®ä¿ç”¨æˆ·å·²ç™»å½•

            if (recordId) {
                try {
                    // Use isFriendMode to determine if using public or private collection
                    const collectionName = recordType.startsWith('debt') ? 'debts' : 'expenses';
                    const collectionRef = getUserCollectionRef(collectionName);
                    if (!collectionRef) return;

                    await deleteDoc(doc(collectionRef, recordId));
                    console.log("è®°å½•åˆ é™¤æˆåŠŸ:", recordId);

                } catch (error) {
                    console.error("åˆ é™¤è®°å½•å¤±è´¥:", error);
                    loginError.textContent = "åˆ é™¤è®°å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–æƒé™ã€‚";
                    loginError.classList.remove('hidden');
                }
            }
        });
        
        // ç›‘å¬ Firestore æ•°æ®å˜åŒ–
        function setupListeners() {
            if (!db || (!currentUserId && !isFriendMode) || !isAuthReady) {
                // å¦‚æœç”¨æˆ·IDæˆ–è®¤è¯æœªå°±ç»ªï¼Œåˆ™ä¸è®¾ç½®ç›‘å¬å™¨
                return;
            }

            const debtsRef = getUserCollectionRef('debts');
            if (!debtsRef) return;

            // ç›‘å¬å€ºåŠ¡å˜åŒ–
            const debtsQuery = query(debtsRef);
            const unsubscribeDebts = onSnapshot(debtsQuery, (snapshot) => {
                const debts = [];
                snapshot.forEach(doc => {
                    debts.push({ id: doc.id, ...doc.data() });
                });
                // å®¢æˆ·ç«¯æ’åºï¼šæŒ‰é‡‘é¢é™åº
                debts.sort((a, b) => b.amount - a.amount);
                renderDebts(debts);
            }, (error) => {
                console.error("ç›‘å¬å€ºåŠ¡æ•°æ®å¤±è´¥:", error);
            });

            const expensesRef = getUserCollectionRef('expenses');
            if (!expensesRef) return;

            // ç›‘å¬å¼€æ”¯å˜åŒ–
            const expensesQuery = query(expensesRef);
            const unsubscribeExpenses = onSnapshot(expensesQuery, (snapshot) => {
                const expenses = [];
                snapshot.forEach(doc => {
                    expenses.push({ id: doc.id, ...doc.data() });
                });
                // å®¢æˆ·ç«¯æ’åºï¼šæŒ‰æ—¶é—´é™åº
                expenses.sort((a, b) => b.createdAt?.toMillis() - a.createdAt?.toMillis());
                renderExpenses(expenses);
            }, (error) => {
                console.error("ç›‘å¬å¼€æ”¯æ•°æ®å¤±è´¥:", error);
            });
            
            // è¿”å›æ¸…ç†å‡½æ•°ï¼Œåœ¨ç”¨æˆ·åˆ‡æ¢æˆ–é€€å‡ºæ—¶ä½¿ç”¨
            return () => {
                unsubscribeDebts();
                unsubscribeExpenses();
            };
        }
        
        // å¯åŠ¨åº”ç”¨
        initializeFirebase();
    </script>
    
    <style>
        /* é¢œè‰²ä¸»é¢˜åˆ‡æ¢ä¸ºä¸“ä¸šè“ */
        .primary-bg { background-color: #1e40af; } /* Blue-800 */
        .primary-text { color: #1e40af; }
        .primary-hover:hover { background-color: #1d4ed8; } /* Blue-700 */
        
        .card {
            background-color: white;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.05);
        }
        
        .input-style {
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            width: 100%;
        }
        
        .hidden { display: none; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">

    <!-- å¤´éƒ¨/å¯¼èˆªæ  -->
    <header class="primary-bg shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-col sm:flex-row justify-between items-center">
            <div class="text-2xl font-bold text-white tracking-wider">
                <span class="mr-2">ğŸ“Š</span> ä¸ªäººè´¢åŠ¡è¿½è¸ªç³»ç»Ÿ
            </div>
            <div class="flex items-center space-x-4 mt-2 sm:mt-0">
                <p id="user-info" class="text-sm text-blue-200">
                    ç”¨æˆ·ID: <span id="user-id-display">...</span> (æ‚¨çš„æ•°æ®)
                </p>
                <button id="sign-out-btn" class="text-sm px-3 py-1 bg-white text-blue-800 rounded-full hover:bg-blue-100 transition shadow-sm">
                    é€€å‡ºç™»å½•
                </button>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        <!-- ç™»å½•/å¯†ç éªŒè¯åŒºåŸŸ (é»˜è®¤æ˜¾ç¤º) -->
        <div id="login-container" class="max-w-sm mx-auto mt-20 card hidden space-y-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ğŸ” è¯·é€‰æ‹©ç™»å½•æ–¹å¼</h2>
            
            <!-- æœ‹å‹ï¼šé€šè¡Œç ç™»å½• -->
            <div class="space-y-3 p-4 border border-gray-200 rounded-lg">
                <p class="font-semibold text-gray-700">é€‰é¡¹ä¸€ï¼šæœ‹å‹ç§˜å¯†é€šè¡Œç </p>
                <input id="passcode-input" type="password" placeholder="è¯·è¾“å…¥ç§˜å¯†é€šè¡Œç " class="input-style text-center tracking-widest" maxlength="8">
                <button id="login-btn" class="w-full py-3 bg-red-600 text-white font-semibold rounded-lg shadow-lg hover:bg-red-700 transition">
                    è§£é”è¿½è¸ªå™¨ (æœ‹å‹)
                </button>
            </div>
            
            <!-- åˆ†éš”çº¿ -->
            <div class="flex items-center">
                <hr class="flex-grow border-t border-gray-300">
                <span class="px-3 text-gray-500 text-sm">æˆ–</span>
                <hr class="flex-grow border-t border-gray-300">
            </div>

            <!-- æ‚¨ï¼šGoogle ç™»å½• -->
            <div class="space-y-3 p-4 border border-gray-200 rounded-lg">
                <p class="font-semibold text-gray-700">é€‰é¡¹äºŒï¼šæ‚¨çš„ Google è´¦å·ç™»å½•</p>
                <button id="google-login-btn" class="w-full py-3 bg-white text-gray-700 border border-gray-300 font-semibold rounded-lg shadow-md hover:bg-gray-100 transition flex items-center justify-center">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/4/4a/Logo-google.png" alt="Google Logo" class="w-5 h-5 mr-3">
                    ä½¿ç”¨ Google è´¦å·ç™»å½• (æ‚¨)
                </button>
            </div>

            <p id="login-error" class="text-red-500 text-center pt-2 hidden"></p>
        </div>

        <!-- è´¢åŠ¡è¿½è¸ªåº”ç”¨åŒºåŸŸ (éªŒè¯é€šè¿‡åæ˜¾ç¤º) -->
        <div id="app-container" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- æ¬ æ¬¾è¿½è¸ªæ¨¡å— (æœ‹å‹éœ€é‡ç‚¹å…³æ³¨) -->
                <div class="lg:col-span-2 card">
                    <h2 class="text-2xl font-bold text-red-700 mb-6 border-b-2 border-red-300 pb-3 flex justify-between items-center">
                        <span class="flex items-center"><span class="mr-2">ğŸ’°</span> æ¬ æ¬¾è¿½è¸ª (Debt Tracker)</span>
                        <span class="text-sm font-normal text-gray-600">æ€»æ¬ æ¬¾: Â¥<span id="total-debt-display" class="font-extrabold text-red-800">0.00</span></span>
                    </h2>

                    <!-- æ·»åŠ æ–°æ¬ æ¬¾è¡¨å• -->
                    <form id="add-debt-form" class="mb-6 p-4 border border-red-200 rounded-lg bg-red-50">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <input id="debt-amount" type="number" step="0.01" placeholder="æ¬ æ¬¾é‡‘é¢ (Â¥)" class="input-style col-span-1" required>
                            <input id="debt-person" type="text" placeholder="æ¬ æ¬¾å¯¹è±¡ (äººå/æœºæ„)" class="input-style col-span-1" required>
                            <input id="debt-note" type="text" placeholder="å¤‡æ³¨ (åŸå› /æ—¥æœŸ)" class="input-style col-span-1">
                            <button type="submit" class="w-full py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition">
                                è®°å½•æ¬ æ¬¾
                            </button>
                        </div>
                    </form>

                    <!-- æ¬ æ¬¾åˆ—è¡¨ -->
                    <ul id="debts-list" class="space-y-2">
                        <!-- æ¬ æ¬¾è®°å½•å°†ç”± JS æ¸²æŸ“ -->
                    </ul>
                </div>

                <!-- æ—¥å¸¸å¼€æ”¯æ¨¡å— -->
                <div class="card">
                    <h2 class="text-2xl font-bold primary-text mb-6 border-b-2 border-blue-300 pb-3 flex justify-between items-center">
                        <span class="flex items-center"><span class="mr-2">ğŸ›’</span> æ—¥å¸¸å¼€æ”¯ (Expense Log)</span>
                        <span class="text-sm font-normal text-gray-600">æ€»å¼€æ”¯: Â¥<span id="total-expense-display" class="font-extrabold primary-text">0.00</span></span>
                    </h2>

                    <!-- æ·»åŠ æ–°å¼€æ”¯è¡¨å• -->
                    <form id="add-expense-form" class="mb-6 p-4 border border-indigo-200 rounded-lg bg-indigo-50">
                        <div class="space-y-3">
                            <input id="expense-amount" type="number" step="0.01" placeholder="å¼€æ”¯é‡‘é¢ (Â¥)" class="input-style" required>
                            <select id="expense-category" class="input-style" required>
                                <option value="é£Ÿç‰©">é£Ÿç‰©</option>
                                <option value="äº¤é€š">äº¤é€š</option>
                                <option value="ä½å®¿">ä½å®¿</option>
                                <option value="ç”Ÿæ´»ç”¨å“">ç”Ÿæ´»ç”¨å“</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                            <input id="expense-note" type="text" placeholder="å¤‡æ³¨ (å…·ä½“ç”¨é€”)" class="input-style">
                            <button type="submit" class="w-full py-2 primary-bg text-white font-medium rounded-lg primary-hover transition">
                                è®°å½•å¼€æ”¯
                            </button>
                        </div>
                    </form>

                    <!-- å¼€æ”¯åˆ—è¡¨ -->
                    <ul id="expenses-list" class="space-y-2">
                        <!-- å¼€æ”¯è®°å½•å°†ç”± JS æ¸²æŸ“ -->
                    </ul>
                </div>
            </div>
        </div>
    </main>

</body>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js')
    .then(() => console.log('Service Worker æ³¨å†ŒæˆåŠŸ'))
    .catch(err => console.log('Service Worker æ³¨å†Œå¤±è´¥', err));
}
</script>

</html>